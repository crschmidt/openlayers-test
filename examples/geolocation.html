<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <title>OpenLayers Geolocation</title>

        <link rel="stylesheet" href="../theme/default/style.css" type="text/css" />
        <link rel="stylesheet" href="style.css" type="text/css" />
        <script src="../lib/OpenLayers.js"></script>
        <script type="text/javascript">
            var map, layer, vector, watchId;
            function init(){
                var style = {
                    fillOpacity: 0.1,
                    fillColor: '#000',
                    strokeColor: '#f00',
                    strokeOpacity: 0.6
                }

                map = new OpenLayers.Map('map');
                layer = new OpenLayers.Layer.OSM( "Simple OSM Map");
                vector = new OpenLayers.Layer.Vector('vector');
                map.addLayers([layer, vector]);

                map.setCenter(
                    new OpenLayers.LonLat(-71.147, 42.472).transform(
                        new OpenLayers.Projection("EPSG:4326"),
                        map.getProjectionObject()
                    ), 12
                );

                var geolocate = new OpenLayers.Control.Geolocate({
                    geolocationOptions: {
                        enableHighAccuracy: false,
                        maximumAge: 0,
                        timeout: 7000
                    }
                });
                map.addControl(geolocate);
                geolocate.events.register("locationupdated",this,function(e) {
                    vector.removeAllFeatures();
                    vector.addFeatures([
                        new OpenLayers.Feature.Vector(
                            e.point,
                            {},
                            {
                                graphicName: 'cross',
                                strokeColor: '#f00',
                                strokeWidth: 2,
                                fillOpacity: 0,
                                pointRadius: 10
                            }
                        ),
                        new OpenLayers.Feature.Vector(
                            OpenLayers.Geometry.Polygon.createRegularPolygon(
                                new OpenLayers.Geometry.Point(e.point.x, e.point.y),
                                e.position.coords.accuracy/2,
                                50,
                                0
                            ),
                            {},
                            style
                        )
                    ]);
                    map.zoomToExtent(vector.getDataExtent());
                });
                geolocate.events.register("locationfailed",this,function() {
                    console.log('Location detection failed');
                });
                window.geolocate = geolocate;

                $('locate').onclick = function() {
                    geolocate.deactivate();
                    $('track').checked = false;
                    geolocate.watch = false;
                    geolocate.activate();
                };
                $('track').onclick = function() {
                    geolocate.deactivate();
                    if (this.checked) {
                        geolocate.watch = true;
                        geolocate.activate();
                    }
                };
            }
        </script>
    </head>
    <body onload="init()">
        <h1 id="title">Geolocation Example</h1>

        <div id="tags">
            geolocation, geolocate, mobile
        </div>

        <p id="shortdesc">
            Track  current position and display it with its accuracy.
        </p>

        <div id="map" class="smallmap"></div>

        <div id="docs">
            <button id="locate">Locate me!</button>
            <label>
                <input type="checkbox" name="track" id="track" />
                Track my position
            </label>&nbsp;
        </div>
    </body>
</html>
