<html>
<head>
  <script src="../lib/OpenLayers.js"></script>
  <script type="text/javascript"><!--
    var isMozilla = (navigator.userAgent.indexOf("compatible") == -1);
    var map; 
    
    function test_01_Events_constructor (t) {
        var mapDiv = $('map');
        var obj = {result: 0};
        var eventTypes = ["doThingA", "doThingB", "doThingC"];
        var browserTypes = OpenLayers.Events.prototype.BROWSER_EVENTS;

        var totalTests = 5 + eventTypes.length + browserTypes.length;

        t.plan( totalTests );

        events = new OpenLayers.Events(obj, mapDiv, eventTypes);

        t.ok( events instanceof OpenLayers.Events, "new OpenLayers.Control returns object" );

        t.ok(events.object ==obj, " 'object' property correctly set");
        t.ok(events.element == mapDiv, " 'element' property correctly set");
        t.ok(events.eventTypes == eventTypes, " 'eventTypes' property correctly set");


        for (var i = 0; i < browserTypes.length; i++) {
            t.ok( events.listeners[browserTypes[i]] instanceof Array, 
                  "browser event: " + browserTypes[i] + " correctly registered" );
        }
        for (var i = 0; i < eventTypes.length; i++) {
            t.ok( events.listeners[eventTypes[i]] instanceof Array, 
                  "custom event: " + eventTypes[i] + " correctly registered");
        }

        // default/nulls
        events = new OpenLayers.Events(null, null, null);
        t.ok( events.listeners != null,
              "init of Events with null object/element/eventTypes still creates listeners array" );
    }

    function test_02_Events_register(t) {
 
        t.plan( 6 );
 
        var mapDiv = $('map');
        var obj = {result: 0};
        var eventTypes = ["doThingA", "doThingB", "doThingC"];
        
        events = new OpenLayers.Events(obj, mapDiv, eventTypes);
        
        var func = function () { this.result++ }
        events.register( "doThingA", obj, func );

        var listenerList = events.listeners["doThingA"];
        t.eq( listenerList.length, 1, "register correctly adds to event.listeners" );
        t.ok( listenerList[0].obj == obj, "obj property correctly registered");
        t.ok( listenerList[0].func == func, "func property correctly registered");

        var func2 = function () { this.result-- }
        events.register( "doThingA", obj, func2 );

        var listenerList = events.listeners["doThingA"];
        t.eq( listenerList.length, 2, "register correctly appends new callback to event.listeners[doThingA]" );
        t.ok( listenerList[1].obj == obj, "obj property correctly registered");
        t.ok( listenerList[1].func == func2, "func property correctly registered");



    }

    function test_03_Events_triggerEvent(t) {
    
        t.plan( 2 );
 
        var mapDiv = $('map');
        var obj = {result: 0};
        var eventTypes = ["doThingA", "doThingB", "doThingC"];
        
        events = new OpenLayers.Events(obj, mapDiv, eventTypes);
        
        
        var func = function () { this.result++ }
        events.register( "doThingA", obj, func );

        events.triggerEvent("doThingA", {});
        t.eq( obj.result, 1, "result is 1 after we call triggerEvent" );
        events.triggerEvent("doThingA");
        t.eq( obj.result, 2, "result is 2 after we call triggerEvent with no event" );

    }
   
  // -->
  </script>
</head>
<body>
    <div id="map" style="width: 1024px; height: 512px;"/>
</body>
</html>
